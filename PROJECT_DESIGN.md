# 八字算命小程序项目设计文档

## 项目概览

### 项目名称
太乙数衍 - 八字算命小程序

### 项目描述
基于传统中国命理学的八字分析工具，提供出生时间分析、五行解读、运势预测等功能的微信小程序。

### 目标用户
- 对传统文化感兴趣的年轻人
- 寻求人生指导的用户群体
- 娱乐消遣用户

## 业务逻辑分析

### 八字算命核心逻辑
1. **时间映射论**: 出生时刻天体运行状态影响个人命运
2. **五行理论**: 金、水、木、火、土的相生相克关系
3. **干支纪年**: 将时间转换为天干地支组合（八字）
4. **格局判断**: 分析命局强弱和格局类型
5. **大运流年**: 预测不同时期的运势变化

### 计算流程
```
出生时间 → 农历转换 → 干支排盘 → 五行分析 → 格局判断 → 运势预测
```

## 技术方案设计

### 技术栈选择
- **前端框架**: uni-app (支持多端发布)
- **开发语言**: Vue.js + JavaScript
- **UI框架**: uni-ui / uView
- **状态管理**: Vuex/Pinia
- **图表组件**: uCharts
- **日期处理**: dayjs
- **存储方案**: 
  - 阶段1: uni.storage (本地存储)
  - 阶段2: uniCloud (云端数据库)

### 项目架构
```
bazi-fortune-app/
├── pages/                 # 页面目录
│   ├── index/            # 首页
│   ├── input/            # 信息输入页
│   ├── result/           # 结果展示页
│   ├── history/          # 历史记录
│   └── profile/          # 个人中心
├── components/           # 组件库
│   ├── BaziChart/        # 八字图表组件
│   ├── WuxingRadar/      # 五行雷达图
│   └── FortuneCard/      # 运势卡片
├── utils/                # 工具函数
│   ├── calendar.js       # 万年历转换
│   ├── bazi-calculator.js # 八字计算引擎
│   ├── wuxing-analyzer.js # 五行分析
│   └── fortune-engine.js  # 运势分析引擎
├── static/               # 静态资源
├── store/                # 状态管理
└── config/               # 配置文件
```

### 核心算法模块设计

#### 1. 万年历转换模块 (calendar.js)
```javascript
class CalendarConverter {
  // 公历转农历
  solarToLunar(year, month, day)
  // 农历转公历  
  lunarToSolar(year, month, day, isLeap)
  // 获取节气
  getSolarTerm(year, month, day)
}
```

#### 2. 八字计算引擎 (bazi-calculator.js)
```javascript
class BaziCalculator {
  // 排八字主方法
  calculateBazi(birthDate, gender, isLunar)
  // 年柱计算
  getYearPillar(year)
  // 月柱计算
  getMonthPillar(year, month, day)
  // 日柱计算
  getDayPillar(year, month, day)
  // 时柱计算
  getHourPillar(dayTiangan, hour)
  // 大运计算
  calculateDayun(bazi, gender)
}
```

#### 3. 五行分析模块 (wuxing-analyzer.js)
```javascript
class WuxingAnalyzer {
  // 五行统计
  countWuxing(bazi)
  // 五行强弱分析
  analyzeStrength(wuxingCount)
  // 用神分析
  findUsefulGod(bazi, wuxingStrength)
  // 五行平衡建议
  getBalanceSuggestion(analysis)
}
```

#### 4. 运势分析引擎 (fortune-engine.js)
```javascript
class FortuneEngine {
  // 综合运势分析
  analyzeOverallFortune(bazi, currentYear)
  // 事业运分析
  analyzeCareerFortune(bazi)
  // 财运分析
  analyzeWealthFortune(bazi)
  // 感情运分析
  analyzeLoveFortune(bazi)
  // 健康运分析
  analyzeHealthFortune(bazi)
}
```

## 功能设计

### 核心功能模块

#### 1. 信息输入模块
- **出生时间选择**: 年月日时精确选择
- **性别选择**: 男/女
- **历法选择**: 公历/农历切换
- **时区处理**: 自动识别或手动选择
- **输入验证**: 日期合法性检查

#### 2. 八字计算模块
- **四柱排盘**: 年月日时四柱展示
- **藏干分析**: 地支藏干显示
- **纳音显示**: 纳音五行展示
- **十神分析**: 十神关系展示
- **格局判断**: 命局格局分析

#### 3. 五行分析模块
- **五行统计图**: 雷达图展示五行强弱
- **五行相生相克**: 动态关系图
- **用神分析**: 用神忌神分析
- **调候用神**: 季节调候建议
- **五行开运**: 颜色、方位建议

#### 4. 运势预测模块
- **综合运势**: 整体运势评分
- **分类运势**: 事业、财运、感情、健康
- **大运分析**: 10年大运周期
- **流年分析**: 当前和未来几年
- **月运分析**: 当前月份运势

#### 5. 结果展示模块
- **可视化图表**: 多种图表展示数据
- **详细解读**: 文字解读结果
- **PDF报告**: 完整报告生成
- **分享功能**: 结果分享到社交平台
- **收藏保存**: 历史记录保存

### 辅助功能模块

#### 1. 历史记录
- 查询历史保存
- 结果对比分析
- 批量管理删除

#### 2. 用户中心
- 个人信息管理
- 会员状态查看
- 设置偏好配置

#### 3. 帮助系统
- 使用教程
- 术语解释
- 常见问题FAQ

## 数据存储设计

### 阶段1: 本地存储方案
```javascript
// 用户输入信息
const userInput = {
  birthDate: '1990-01-01 08:00',
  gender: '男',
  isLunar: false,
  timezone: 'Asia/Shanghai'
}

// 计算结果缓存
const baziResult = {
  pillars: {...},      // 四柱信息
  wuxing: {...},       // 五行分析
  fortune: {...},      // 运势结果
  timestamp: Date.now()
}
```

### 阶段2: 云端存储方案
```sql
-- 用户表
CREATE TABLE users (
  id INT PRIMARY KEY AUTO_INCREMENT,
  openid VARCHAR(50) UNIQUE,
  nickname VARCHAR(50),
  avatar_url VARCHAR(200),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 八字记录表
CREATE TABLE bazi_records (
  id INT PRIMARY KEY AUTO_INCREMENT,
  user_id INT,
  birth_date DATETIME,
  gender ENUM('男', '女'),
  is_lunar BOOLEAN,
  bazi_data JSON,
  result_data JSON,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id)
);

-- 用户收藏表
CREATE TABLE user_favorites (
  id INT PRIMARY KEY AUTO_INCREMENT,
  user_id INT,
  record_id INT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id),
  FOREIGN KEY (record_id) REFERENCES bazi_records(id)
);
```

## 商业模式设计

### 免费功能
- 基础八字排盘
- 简单五行分析
- 基础运势概览
- 每日运势查看

### 付费功能
- 详细命理解读报告 (¥9.9-19.9)
- 专业运势分析 (¥29.9-49.9)
- 流年大运详解 (¥19.9-39.9)
- 合婚配对分析 (¥39.9-69.9)
- 起名改名服务 (¥99-299)
- VIP会员服务 (¥99/年)

### 会员权益
- 无限次查询
- 高级功能解锁
- 专家在线咨询
- 定制化报告
- 广告免费体验

## 合规风险控制

### 内容审核标准
1. **避免绝对化表述**: 不使用"一定"、"必然"等词汇
2. **娱乐化定位**: 标注"仅供娱乐参考"
3. **避免医疗建议**: 不涉及健康诊断和治疗建议
4. **文化传承角度**: 强调传统文化传承和体验
5. **理性消费引导**: 提醒用户理性对待结果

### 免责声明模板
```
本应用提供的八字分析仅基于传统文化算法，
结果仅供娱乐和文化体验参考，不构成任何
人生决策建议。请用户理性对待分析结果，
任何重要决定请结合实际情况综合考虑。
```

## 开发阶段规划

### 第一阶段: MVP核心功能 (2-3周)
**目标**: 实现基础的八字计算和展示功能

#### 任务清单:
- [ ] 项目初始化和环境搭建
- [ ] 万年历转换算法实现
- [ ] 基础八字排盘功能
- [ ] 简单的结果展示页面
- [ ] 基础UI界面开发

#### 完成标准:
- 用户可以输入出生信息
- 系统能正确计算八字
- 可以展示基础的八字信息
- 界面基本可用，无明显bug

#### 技术重点:
- 农历公历转换精确性
- 干支计算算法正确性
- 时辰划分准确性

### 第二阶段: 五行分析功能 (2-3周)
**目标**: 完善五行分析和可视化展示

#### 任务清单:
- [ ] 五行统计算法实现
- [ ] 五行强弱分析逻辑
- [ ] 用神忌神分析算法
- [ ] 五行雷达图组件开发
- [ ] 五行分析结果页面

#### 完成标准:
- 准确统计八字中的五行
- 正确分析五行强弱
- 可视化展示五行分布
- 提供基础的五行建议

#### 技术重点:
- 五行计算权重算法
- 图表组件集成
- 数据可视化效果

### 第三阶段: 运势分析系统 (3-4周)
**目标**: 实现comprehensive运势分析功能

#### 任务清单:
- [ ] 大运计算算法
- [ ] 流年分析逻辑
- [ ] 分类运势算法(事业/财运/感情/健康)
- [ ] 运势评分系统
- [ ] 详细解读文案系统
- [ ] 运势展示页面开发

#### 完成标准:
- 准确计算大运信息
- 提供各类运势分析
- 生成合理的运势评分
- 展示易懂的解读内容

#### 技术重点:
- 复杂的命理规则实现
- 文案生成算法
- 评分权重系统

### 第四阶段: 完善用户体验 (2-3周)
**目标**: 优化界面和用户体验

#### 任务清单:
- [ ] 界面美化和动画效果
- [ ] 本地历史记录功能
- [ ] 结果分享功能
- [ ] 帮助文档和使用指南
- [ ] 错误处理和用户提示
- [ ] 性能优化

#### 完成标准:
- 界面美观流畅
- 功能交互友好
- 历史记录正常工作
- 分享功能可用

#### 技术重点:
- UI/UX优化
- 本地存储管理
- 分享API集成

### 第五阶段: 商业化功能 (3-4周)
**目标**: 实现付费功能和用户系统

#### 任务清单:
- [ ] 微信登录集成
- [ ] uniCloud后端搭建
- [ ] 用户数据云端同步
- [ ] 微信支付集成
- [ ] 付费内容管控
- [ ] 会员权益系统
- [ ] 订单管理系统

#### 完成标准:
- 用户可以正常登录
- 付费功能正常工作
- 数据云端同步
- 订单流程完整

#### 技术重点:
- 微信API集成
- 支付流程实现
- 云端数据库设计
- 权限控制系统

### 第六阶段: 测试与发布 (2-3周)
**目标**: 全面测试并准备上线

#### 任务清单:
- [ ] 功能完整性测试
- [ ] 兼容性测试(多端)
- [ ] 性能压力测试
- [ ] 内容合规审查
- [ ] 小程序提审准备
- [ ] 用户反馈收集机制
- [ ] 线上监控配置

#### 完成标准:
- 所有功能正常工作
- 通过小程序审核
- 性能指标达标
- 内容符合规范

## 质量保证

### 代码规范
- ESLint + Prettier 代码格式化
- Vue/JavaScript 编码标准
- 组件命名规范
- 文件目录结构规范

### 测试策略
- 单元测试: 核心算法函数
- 集成测试: 页面功能流程  
- 兼容测试: 不同设备和版本
- 性能测试: 计算速度和内存使用

### 版本控制
- Git 分支管理策略
- 代码审查流程
- 版本发布流程
- 回滚应急预案

## 风险评估与应对

### 技术风险
- **算法准确性风险**: 多重验证, 测试用例覆盖
- **性能风险**: 算法优化, 结果缓存
- **兼容性风险**: 多端测试, 渐进式降级

### 合规风险  
- **内容审核风险**: 专业法务审查, 动态调整
- **平台政策变化**: 关注政策动态, 快速响应
- **用户投诉风险**: 完善客服体系, 及时处理

### 商业风险
- **市场竞争风险**: 差异化定位, 用户体验优化
- **付费转化风险**: A/B测试, 价格策略调整
- **用户留存风险**: 内容更新, 功能迭代

## 监控与运维

### 关键指标监控
- **用户指标**: DAU, MAU, 留存率
- **业务指标**: 付费转化率, ARPU值
- **技术指标**: 响应时间, 错误率, 崩溃率
- **内容指标**: 功能使用率, 满意度评分

### 运维保障
- **服务监控**: 实时监控系统状态
- **日志分析**: 用户行为和错误日志
- **备份策略**: 数据备份和灾难恢复
- **更新发布**: 灰度发布和快速回滚

## 团队协作

### 角色分工
- **产品经理**: 需求分析, 功能规划
- **UI设计师**: 界面设计, 用户体验
- **前端开发**: 页面开发, 算法实现
- **后端开发**: 服务端API, 数据库设计
- **测试工程师**: 功能测试, 性能测试

### 协作流程
- **需求评审**: 功能需求确认
- **设计评审**: UI/交互设计确认  
- **代码评审**: 代码质量保证
- **测试评审**: 测试用例和结果
- **发布评审**: 上线前最终检查

---

## 项目状态跟踪

### 当前状态: 项目初始化
- [x] 项目设计文档完成
- [ ] 开发环境搭建
- [ ] 第一阶段开发开始

### 下一步计划:
1. 搭建uni-app开发环境
2. 创建项目基础结构
3. 实现万年历转换功能
4. 开发八字计算核心算法

### 更新日志:
- 2025-01-10: 项目设计文档创建完成

---

*本文档将随着项目进展持续更新，记录开发过程中的关键决策和变更。*